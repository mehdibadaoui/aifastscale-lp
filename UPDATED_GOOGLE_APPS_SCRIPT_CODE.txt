// UPDATED CODE WITH CORS SUPPORT
// Replace ALL your Google Apps Script code with this:

function doPost(e) {
  try {
    // Get the active spreadsheet
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();

    // Parse the incoming data
    const data = JSON.parse(e.postData.contents);

    // Add new row with data
    sheet.appendRow([
      new Date(),                    // Timestamp
      data.email || '',              // Email
      data.name || '',               // Name (optional)
      data.source || 'Thank You Page', // Source
      data.ip || '',                 // IP Address
      data.userAgent || ''           // User Agent
    ]);

    // Return success response with CORS headers
    return ContentService
      .createTextOutput(JSON.stringify({
        'success': true,
        'message': 'Email added successfully'
      }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch(error) {
    // Return error response
    return ContentService
      .createTextOutput(JSON.stringify({
        'success': false,
        'message': error.toString()
      }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

// Handle OPTIONS requests for CORS preflight
function doGet(e) {
  return ContentService
    .createTextOutput(JSON.stringify({'status': 'ready'}))
    .setMimeType(ContentService.MimeType.JSON);
}
